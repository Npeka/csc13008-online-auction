enum OrderStatus {
  PENDING_PAYMENT      // Order created, waiting for buyer payment proof
  PAYMENT_SUBMITTED    // Buyer submitted payment proof, waiting for seller
  SHIPPED              // Seller confirmed and uploaded shipping receipt
  DELIVERED            // Buyer confirmed delivery
  COMPLETED            // Rating phase done
  CANCELLED            // Seller cancelled the order
}

// Order/Transaction management after auction ends
model Order {
  id         String      @id @default(cuid())
  finalPrice Float
  status     OrderStatus @default(PENDING_PAYMENT)

  // Payment & Shipping information
  paymentProof      String? // Buyer's payment proof image URL
  shippingProof     String? // Seller's shipping receipt image URL
  shippingAddress   String?
  trackingNumber    String? // Optional shipping tracking number
  cancellationReason String? // Reason if cancelled

  // Relations
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id])
  buyerId   String
  buyer     User    @relation("OrderBuyer", fields: [buyerId], references: [id])
  sellerId  String
  seller    User    @relation("OrderSeller", fields: [sellerId], references: [id])

  // Chat and ratings
  messages ChatMessage[]
  ratings  Rating[]

  // Timestamps
  createdAt   DateTime  @default(now())
  paidAt      DateTime?
  shippedAt   DateTime?
  deliveredAt DateTime?
  completedAt DateTime?
  cancelledAt DateTime? // When order was cancelled
  updatedAt   DateTime  @updatedAt

  @@index([buyerId, status])
  @@index([sellerId, status])
  @@index([status, createdAt])
  @@map("orders")
}
